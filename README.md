# Консольные утилиты для Evernote

Набор утилит для работы с сервисом заметок Evernote. Реализован запрос списка блокнотов, запрос и отображение текста заметок указанного блокнота, а также создание новой заметки с указанным текстом.

Внимание! Используется тестовое [Evernote SDK](https://github.com/evernote/evernote-sdk-python3) для Python 3. Больше информации: https://dev.evernote.com/doc/start/python.php

## Требования

Должно быть установлены следующее ПО:

- [Python 3.x](https://www.python.org/)
- [Git](https://git-scm.com/download)

Опционально: для Windows удобно использовать:

- [GitHub Desktop](https://desktop.github.com/) &mdash; gui для git.
- [Cmdr](https://cmder.net/) &mdash; удобная замена стандартной командной строке Windows.

## Как установить

Скопируйте репозиторий. В терминале выполните команду:

```shell
git clone https://github.com/OrionApplePie/evernote-example.git
```

После чего репозиторий загрузится и будет доступен локально.

Далее в терминале перейдите в папку с репозиторием, и используйте `pip` (или `pip3`, если есть конфликт с Python2) для установки зависимостей:

```shell
pip install -r requirements.txt
```

## Создание ноутбука Evernote

Нужна учетная запись в https://evernote.com/. Для работы в песочнице зарегистрируйтесь на сервере разработки https://sandbox.evernote.com/Registration.action.

Для работы утилит необходимо создать ноутбук для входящих заметок, а также ноутбук-журнал для хранения заметок-записей, например с именем "Дневник". Также необходимо создать пустую заметку-шаблон с заголовком "Заметка {date} {dow} # шаблон".

## Получение секретного токена

Зарегистрируйтесь на сервере разработки https://sandbox.evernote.com/Registration.action и получите токены.
Токены разработчика позволяют вам использовать API Evernote для доступа к вашей личной учетной записи Evernote. Чтобы узнать больше об использовании токенов разработчика, посетите dev.evernote.com.

Есть два варианта использования утилит с токеном разработчика.

### 1. В режиме разработки в "песочнице"

Получите токен разработчика для песочницы &ndash; https://dev.evernote.com/doc/articles/dev_tokens.php.

### 2. На продакшн сервере.

Чтобы использовать утилиты на продакшн сервере, нужно получить отдельный токен https://dev.evernote.com/doc/articles/dev_tokens.php. Однако сейчас автоматическое генерирование токенов для продакшн серверов не работает.
Для получения токена следуйте инструкции на [форуме Evernote](https://discussion.evernote.com/forums/topic/113349-developer-token-requests/).

## Переменные окружения

Настройки проекта берутся из переменных окружения. Чтобы их определить, создайте файл `.env` в корне проекта и запишите туда данные в таком формате: `ПЕРЕМЕННАЯ=значение`.

Необходимые переменные:

- `SANDBOX` &ndash; режим разработки, поставьте `True`, чтобы работать в "песочнице".
- `EVERNOTE_SANDBOX_DEVELOPER_TOKEN` &ndash; токен разработчика для песочницы.
- `EVERNOTE_PRODUCTION_DEVELOPER_TOKEN` &ndash; токен разработчика для продакшена.
- `JOURNAL_NOTEBOOK_GUID` &ndash; идентификатор ноутбука-журнала, где создавать заметки.
- `JOURNAL_TEMPLATE_NOTE_GUID` &ndash; идентификатор шаблонной заметки.
- `INBOX_NOTEBOOK_GUID` &ndash; идентификатор ноутбука для входящих заметок.

Как получить идентификаторы см. ниже.

## Разработчикам

Реальные приложения должны использовать [OAuth](https://dev.evernote.com/doc/articles/authentication.php) вместе с ключом и секретом (https://dev.evernote.com/doc/), которые нужно добавить в `.env` и `config.py`. (здесь вносить не нужно):

- `EVERNOTE_CONSUMER_KEY`
- `EVERNOTE_CONSUMER_SECRET`


## Использование

В терминале перейдите в папку с проектом и введите команду:

```shell
python list_notebooks.py
```

для запроса и печати списка ваших ноутбуков Evernote.

```shell
python dump_inbox.py -number N -notebook_id guid
```
для вывода текста заметок из ноутбука по указанному guid (если не указан, то по умолчанию берется из `INBOX_NOTEBOOK_GUID`). Где `N` &ndash; максимальное число заметок для вывода, `guid` &ndash; идентификатор целевого ноутбука.

```shell
python add_note2journal.py -date YYYY-MM-DD -message "text here"
```

для создания новой заметки из шаблонной. YYYY-MM-DD &ndash; дата (опционально). "text here" &ndash; текст вашей заметки (опционально).

## Как получить идентификаторы

Чтобы узнать все нужные идентификаторы (guid) следуйте инструкции:

1) Получите список всех ноутбуков, скопируйте идентификаторы дневника и входящих и запишите их в .env

```shell
❯ python list_notebooks.py

3o477427-9a8a-013c-a831-465b5d83f0e1 - Мой блокнот (INBOX)
e2288027-5c4i-728a-a926-5ef923e3bc9a - Дневник
```

2) Получите идентификатор заметки-шаблона, запустите

```shell
❯ python dump_inbox.py -notebook_id e2288027-5c4i-728a-a926-5ef923e3bc9a

--------- 1 ---------
Note id: 1f5fe527-5097-4b12-ff3a-a4795b5a4h4f
Note title: Заметка {date} {dow} # шаблон
```
внесите идентификатор в .env

## Модуль list_notebooks.py

Запрос и вывод списка ноутбуков. Создается объект клиента `EvernoteClient` для работы с API Evernote и, с помощью метода `get_note_store` запрашивается список ноутбуков. Далее он выводится вместе и идентификаторами.

## Модуль dump_inbox.py

Запрос заметок из указанного ноутбука и их печать в консоль. Принимает аргумент &ndash; максимальное количество заметок (по умолчанию 10) и идентификатор ноутбука, использует метод `findNotesMetadata` и `NoteFilter` для указания идентификатора ноутбука и структуру `NotesMetadataResultSpec` для указания того что включать в результат поиска (заголовок, дату создания и пр.). Печатает текст заметок обработанный с помощью библиотеки `BeautifulSoup`.

## Модуль add_note2journal.py

Создание заметки с текстом из шаблона. Принимает аргументами дату и текст заметки. Создает объект клиента `EvernoteClient`, получает хранилище записей методом `get_note_store`, создает новую заметку путем копирования (`copyNote`) заметки-шаблона, вставляет в заголовок шаблона дату и день недели, и если указан текст, то добавляет его в содержимое заметки.


## Цели проекта

Код написан в учебных целях — это урок в курсе по Python и веб-разработке на сайте [Devman](https://dvmn.org).
